<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Errechnete Geschwindigkeit</title>

<style>
  :root{
    --ink:#000;
    --border:#cbd5e1;
    --bg:#f8fafc;
  }

  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: Arial, Helvetica, sans-serif;
    color:var(--ink);
    background:var(--bg);
  }

  /* ===== Druck / PDF (A4) ===== */
  @page{
    size: A4;
    margin: 16mm;
  }

  /* ===== ÄUSSERE SEITE ===== */
  .page{
    max-width: 1100px;
    margin: 24px auto;
    padding: 20px;
  }

  /* ===== WEISSE KACHEL ===== */
  .sheet{
    background:#fff;
    border:1px solid var(--border);
    border-radius:12px;
    padding:26px 28px 24px;
  }

  /* ===== HEADER ===== */
  .header{
    position: relative;
    height: 36px;
  }
  .logo{
    position:absolute;
    top:0;
    right:0;
    font-weight:700;
    font-size:24px;
    line-height:1.1;
  }

  .title{
    margin-top: 8px;
    font-size: 20px;
    font-weight: 700;
  }

  /* ===== GRID (stabil) ===== */
  .grid{
    display:grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap:16px;
    margin-top:18px;
  }

  label{
    display:block;
    font-size:12px;
    margin-bottom:6px;
  }

  input{
    width:100%;
    height:40px;
    padding:8px 10px;
    border:1px solid var(--border);
    border-radius:8px;
    font: 14px Arial, Helvetica, sans-serif;
    background:#fff;
  }

  /* hilft gegen "min-content" Effekte */
  input[type="time"]{ min-width:0; }

  .hint{
    font-size:12px;
    margin-top:6px;
    opacity:.8;
  }

  .actions{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    margin-top:18px;
    align-items:center;
  }

  button{
    height:40px;
    padding:0 14px;
    border-radius:8px;
    border:1px solid var(--border);
    background:#fff;
    cursor:pointer;
    font: 14px Arial, Helvetica, sans-serif;
    
button.primary{
  border-color:#0064a8;
  background:#0064a8;
  color:#fff;
}

button.primary:hover{
  background:#00538d;
  border-color:#00538d;
}


  /* ===== Toggle ===== */
  .toggle{
    display:flex;
    align-items:center;
    gap:10px;
    padding:8px 10px;
    border:1px solid var(--border);
    border-radius:10px;
    background:#fff;
    height:40px;
  }
  .toggle .tlabel{
    font-size:13px;
    white-space:nowrap;
  }
  .switch{
    position:relative;
    width:46px;
    height:26px;
    flex:0 0 auto;
  }
  .switch input{
    position:absolute;
    inset:0;
    opacity:0;
    cursor:pointer;
    margin:0;
  }
  .track{
    position:absolute;
    inset:0;
    border:1px solid var(--border);
    border-radius:999px;
    background:#e5e7eb;
    transition:background .15s ease;
  }
  .knob{
    position:absolute;
    top:3px;
    left:3px;
    width:20px;
    height:20px;
    border-radius:999px;
    background:#fff;
    border:1px solid var(--border);
    transition:transform .15s ease;
  }
  .switch input:checked + .track{
    background:#111;
    border-color:#111;
  }
  .switch input:checked + .track .knob{
    transform:translateX(20px);
  }

  .result{
    margin-top:18px;
    border-top:1px dashed var(--border);
    padding-top:14px;
    display:grid;
    gap:8px;
  }

  .row{
    display:flex;
    justify-content:space-between;
    gap:12px;
    font-size:14px;
  }
  .row b{font-weight:700}

  .error{
    margin-top:10px;
    color:#b00020;
    font-size:13px;
    display:none;
  }

  /* ===== DRUCK ===== */
  @media print{
    body{ background:#fff; }
    .page{ margin:0; padding:0; max-width:none; }
    .sheet{ border:none; border-radius:0; padding:0; }
    .actions, .hint { display:none !important; }
    input{ border:1px solid #999; }
  }
</style>
</head>

<body>
  <div class="page">
    <div class="sheet" id="printArea">
      <div class="header">
        <div class="logo">Flughafen Zürich</div>
      </div>

      <div class="title">Errechnete Geschwindigkeit</div>

      <div class="grid">
        <div>
          <label for="start">Start (Zeit)</label>
          <input id="start" type="time" step="1" value="00:00:00" />
          <div class="hint">Format: HH:MM:SS</div>
        </div>

        <div>
          <label for="end">Ende (Zeit)</label>
          <input id="end" type="time" step="1" value="00:00:10" />
          <div class="hint">Format: HH:MM:SS</div>
        </div>

        <div>
          <label for="dist">Distanz (m)</label>
          <input id="dist" type="number" min="0" step="0.01" placeholder="z.B. 120" />
          <div class="hint">Meter (m)</div>
        </div>
      </div>

      <div class="actions">
        <button class="primary" id="calcBtn">Berechnen</button>
        <button id="pdfBtn">Als PDF speichern</button>
        <button id="resetBtn">Zurücksetzen</button>

        <!-- Toggle: standard EIN -->
        <div class="toggle" title="Video/Nachfahrmessung: bis 100 km/h −10 km/h, über 100 km/h −10%">
          <div class="tlabel">Toleranz abziehen</div>
          <label class="switch">
            <input type="checkbox" id="tolToggle" checked />
            <span class="track"><span class="knob"></span></span>
          </label>
        </div>
      </div>

      <div class="error" id="err"></div>

      <div class="result" aria-live="polite">
        <div class="row">
          <span>Dauer</span>
          <b id="durOut">—</b>
        </div>

        <div class="row">
          <span>Errechnete Geschwindigkeit</span>
          <b id="speedKmhRawOut">—</b>
        </div>

        <div class="row">
          <span>Toleranzabzug (Video)</span>
          <b id="tolOut">—</b>
        </div>

        <div class="row">
          <span>Relevant nach Toleranz</span>
          <b id="speedKmhAdjOut">—</b>
        </div>

        <div class="row">
          <span>Errechnete Geschwindigkeit (m/s)</span>
          <b id="speedOut">—</b>
        </div>
      </div>
    </div>
  </div>

<script>
  // Elemente sauber holen (Edge-sicher)
  const elStart = document.getElementById("start");
  const elEnd   = document.getElementById("end");
  const elDist  = document.getElementById("dist");

  const elDur   = document.getElementById("durOut");
  const elVms   = document.getElementById("speedOut");

  const elVkmhRaw = document.getElementById("speedKmhRawOut");
  const elTol     = document.getElementById("tolOut");
  const elVkmhAdj = document.getElementById("speedKmhAdjOut");

  const elErr   = document.getElementById("err");
  const btnCalc = document.getElementById("calcBtn");
  const btnPdf  = document.getElementById("pdfBtn");
  const btnReset= document.getElementById("resetBtn");

  const elTolToggle = document.getElementById("tolToggle");

  function parseTimeToSeconds(t){
    if(!t) return NaN;
    const p = t.split(":").map(Number); // "HH:MM" oder "HH:MM:SS"
    if(p.length < 2) return NaN;
    const h = p[0] || 0, m = p[1] || 0, s = p[2] || 0;
    return h*3600 + m*60 + s;
  }

  function formatDuration(sec){
    const s = Math.max(0, Math.round(sec));
    const hh = String(Math.floor(s/3600)).padStart(2,"0");
    const mm = String(Math.floor((s%3600)/60)).padStart(2,"0");
    const ss = String(s%60).padStart(2,"0");
    return `${hh}:${mm}:${ss}`;
  }

  function showError(msg){
    elErr.textContent = msg || "";
    elErr.style.display = msg ? "block" : "none";
  }

  // Toleranz (Video/Nachfahrt) innerorts: bis 100 km/h -> -10 km/h, darüber -> -10%
  function applyVideoToleranceKmh(v_kmh){
    if(v_kmh <= 100){
      return { tol: 10, mode: "kmh" }; // -10 km/h
    }
    return { tol: v_kmh * 0.10, mode: "pct" }; // -10%
  }

  function calc(){
    showError("");

    const startStr = elStart.value;
    const endStr   = elEnd.value;
    const distStr  = elDist.value;

    const distMeters = Number(distStr);
    if(!isFinite(distMeters) || distMeters <= 0){
      showError("Bitte eine Distanz > 0 m eingeben.");
      return;
    }

    const s0 = parseTimeToSeconds(startStr);
    const s1 = parseTimeToSeconds(endStr);
    if(!isFinite(s0) || !isFinite(s1)){
      showError("Bitte Start- und Endzeit korrekt eingeben.");
      return;
    }

    let dt = s1 - s0;
    if(dt <= 0) dt += 86400; // über Mitternacht

    if(dt <= 0){
      showError("Die Dauer muss > 0 Sekunden sein.");
      return;
    }

    const v_ms  = distMeters / dt;
    const v_kmh = v_ms * 3.6;

    // Outputs raw
    elDur.textContent  = `${formatDuration(dt)} (${dt.toFixed(2)} s)`;
    elVms.textContent  = `${v_ms.toFixed(3)} m/s`;
    elVkmhRaw.textContent = `${v_kmh.toFixed(2)} km/h`;

    // Toleranz optional
    if(elTolToggle.checked){
      const t = applyVideoToleranceKmh(v_kmh);
      const adj = Math.max(0, v_kmh - t.tol);

      elTol.textContent = (t.mode === "kmh")
        ? `−${t.tol.toFixed(0)} km/h`
        : `−${t.tol.toFixed(2)} km/h (10%)`;

      elVkmhAdj.textContent = `${adj.toFixed(2)} km/h`;
    }else{
      elTol.textContent = "— (aus)";
      elVkmhAdj.textContent = `${v_kmh.toFixed(2)} km/h`;
    }
  }

  btnCalc.addEventListener("click", calc);
  btnPdf.addEventListener("click", () => { calc(); window.print(); });

  // bei Toggle-Änderung sofort neu berechnen, wenn schon Werte da sind
  elTolToggle.addEventListener("change", () => { calc(); });

  btnReset.addEventListener("click", () => {
    elStart.value = "00:00:00";
    elEnd.value   = "00:00:10";
    elDist.value  = "";
    elDur.textContent = "—";
    elVms.textContent = "—";
    elVkmhRaw.textContent = "—";
    elTol.textContent = "—";
    elVkmhAdj.textContent = "—";
    showError("");
    elTolToggle.checked = true; // wieder Standard: EIN
  });
</script>
</body>
</html>
